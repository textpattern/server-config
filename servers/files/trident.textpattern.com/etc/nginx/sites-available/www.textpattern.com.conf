#server block for www.textpattern.com (created: 2018-11-29 20:25:48)
map $sent_http_content_type $www_textpattern_com_expires {
	application/atom+xml 1h;
	application/javascript 1M;
	application/json 0s;
	application/ld+json 0s;
	application/manifest+json 1w;
	application/rdf+xml 1h;
	application/rss+xml 1h;
	application/schema+json 0s;
	application/x-javascript 1M;
	application/xml 0s;
	font/woff 1M;
	font/woff2 2w;
	image/gif 1M;
	image/jpeg 1M;
	image/png 1M;
	image/svg+xml 1M;
	image/vnd.microsoft.icon 1M;
	image/webp 1M;
	image/x-icon 1M;
	text/cache-manifest 0s;
	text/css 1M;
	text/html 0s;
	text/javascript 1M;
	text/x-cross-domain-policy 1w;
	text/xml 3600s;
	video/mp4 1M;
	video/webm 1M;
	default 0s;
}

server {#http(/1), https(/2) return, PHP FastCGI
	access_log /var/log/nginx/www.textpattern.com.access.log ipscrubbed;
	error_log /var/log/nginx/www.textpattern.com.error.log error;
	index index.html index.php;
	listen [::]:80;
	listen 80;
	return 301 https://textpattern.com$request_uri;
	root /var/www/vhosts/textpattern.com/www/live;
	server_name www.textpattern.com;
	server_name textpattern.com;
	location ^~ /.well-known/ {
		allow all;
		default_type "text/plain";
		root /var/www/vhosts/textpattern.com/www/_well-known/;
		try_files $uri $uri/ =404;		
	}
	location /favicon.ico {
		access_log off;
		log_not_found off;
	}
	location /robots.txt {
		access_log off;
		log_not_found off;
	}
	location ~ /\. {
		deny all;
	}
	location ~ \.svg$ {
		add_header Content-Security-Policy "default-src 'none'; frame-ancestors 'none'; style-src 'self' 'unsafe-inline'";
	}
	location / {
		index index.html index.php;
		limit_except GET HEAD POST {
			deny all;
		}
		try_files $uri $uri/ /index.php?$args;
	}
	location ~ ^.+\.php(?:/.*)?$ {
		fastcgi_hide_header "X-Powered-By";
		fastcgi_index index.php;
		fastcgi_keep_conn on;
		fastcgi_next_upstream error timeout;
		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
		fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;
		fastcgi_split_path_info ^(.+\.php)(/.+)$;
		include fastcgi_params;
		try_files $uri =404;
	}
}

server {#https(/2), redirect https://www.textpattern.com to https://textpattern.com
	listen [::]:443 http2 ssl;
	listen 443 http2 ssl;
	server_name www.textpattern.com;
	ssl_certificate /etc/letsencrypt/live/www.textpattern.com/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/www.textpattern.com/privkey.pem;
	ssl_trusted_certificate /etc/letsencrypt/live/www.textpattern.com/fullchain.pem;
	return 301 https://textpattern.com$request_uri;
}

server {#https(/2), PHP FastCGI
	access_log /var/log/nginx/www.textpattern.com.access.log ipscrubbed;
	#nested variable for Content Security Policy maintainability
	set $contentsecuritypolicy_https_www_textpattern_com '';
	set $contentsecuritypolicy_https_www_textpattern_com '${contentsecuritypolicy_https_www_textpattern_com}connect-src \'self\';';
	set $contentsecuritypolicy_https_www_textpattern_com '${contentsecuritypolicy_https_www_textpattern_com}default-src \'none\';';
	set $contentsecuritypolicy_https_www_textpattern_com '${contentsecuritypolicy_https_www_textpattern_com}font-src \'self\';';
	set $contentsecuritypolicy_https_www_textpattern_com '${contentsecuritypolicy_https_www_textpattern_com}frame-ancestors \'none\';';
	set $contentsecuritypolicy_https_www_textpattern_com '${contentsecuritypolicy_https_www_textpattern_com}img-src data: \'self\';';
	set $contentsecuritypolicy_https_www_textpattern_com '${contentsecuritypolicy_https_www_textpattern_com}manifest-src \'self\';';
	set $contentsecuritypolicy_https_www_textpattern_com '${contentsecuritypolicy_https_www_textpattern_com}media-src \'self\';';
	set $contentsecuritypolicy_https_www_textpattern_com '${contentsecuritypolicy_https_www_textpattern_com}object-src \'none\';';
	set $contentsecuritypolicy_https_www_textpattern_com '${contentsecuritypolicy_https_www_textpattern_com}script-src https://cdn.ampproject.org \'self\' \'unsafe-inline\';';
	set $contentsecuritypolicy_https_www_textpattern_com '${contentsecuritypolicy_https_www_textpattern_com}style-src \'self\' \'unsafe-inline\';';
	set $contentsecuritypolicy_https_www_textpattern_com '${contentsecuritypolicy_https_www_textpattern_com}worker-src \'self\';';
	add_header Content-Security-Policy $contentsecuritypolicy_https_www_textpattern_com;
	#nested variable for Feature Policy maintainability
	set $featurepolicy_https_www_textpattern_com '';
	set $featurepolicy_https_www_textpattern_com '${featurepolicy_https_www_textpattern_com}camera \'none\';';
	set $featurepolicy_https_www_textpattern_com '${featurepolicy_https_www_textpattern_com}fullscreen \'self\';';
	set $featurepolicy_https_www_textpattern_com '${featurepolicy_https_www_textpattern_com}geolocation \'none\';';
	set $featurepolicy_https_www_textpattern_com '${featurepolicy_https_www_textpattern_com}gyroscope \'none\';';
	set $featurepolicy_https_www_textpattern_com '${featurepolicy_https_www_textpattern_com}magnetometer \'none\';';
	set $featurepolicy_https_www_textpattern_com '${featurepolicy_https_www_textpattern_com}microphone \'none\';';
	set $featurepolicy_https_www_textpattern_com '${featurepolicy_https_www_textpattern_com}midi \'none\';';
	set $featurepolicy_https_www_textpattern_com '${featurepolicy_https_www_textpattern_com}notifications \'self\';';
	set $featurepolicy_https_www_textpattern_com '${featurepolicy_https_www_textpattern_com}payment \'none\';';
	set $featurepolicy_https_www_textpattern_com '${featurepolicy_https_www_textpattern_com}push \'self\';';
	set $featurepolicy_https_www_textpattern_com '${featurepolicy_https_www_textpattern_com}speaker \'none\';';
	set $featurepolicy_https_www_textpattern_com '${featurepolicy_https_www_textpattern_com}sync-xhr \'self\';';
	set $featurepolicy_https_www_textpattern_com '${featurepolicy_https_www_textpattern_com}vibrate \'none\''; #no trailing semicolon
	add_header Expect-CT "max-age=0; report-uri=https://textpattern.com/expect-ct-report";
	add_header Feature-Policy $featurepolicy_https_www_textpattern_com;
	add_header Referrer-Policy strict-origin;
	add_header Strict-Transport-Security "max-age=15768000; includeSubDomains; preload";
	add_header X-Content-Type-Options nosniff;
	add_header X-Frame-Options DENY;
	add_header X-XSS-Protection "1; mode=block";
	charset_types
		application/atom+xml
		application/javascript
		application/json
		application/ld+json
		application/manifest+json
		application/rdf+xml
		application/rss+xml
		application/xml
		text/cache-manifest
		text/css
	;
	error_log /var/log/nginx/www.textpattern.com.error.log error;
	etag off;
	index index.html index.php;
	listen [::]:443 http2 ssl;
	listen 443 http2 ssl;
	root /var/www/vhosts/textpattern.com/www/live;
	server_name textpattern.com;
	ssl_certificate /etc/letsencrypt/live/www.textpattern.com/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/www.textpattern.com/privkey.pem;
	ssl_trusted_certificate /etc/letsencrypt/live/www.textpattern.com/fullchain.pem;
	location = /sitemap.xml {
		rewrite "sitemap.xml" /index.php?s=sitemap;
	}
	location = /version.json {
		rewrite "version.json" /index.php?s=version;
	}
	location ^~ /.well-known/ {
		allow all;
		default_type "text/plain";
		root /var/www/vhosts/textpattern.com/www/_well-known/;
		try_files $uri $uri/ =404;
	}
	location /favicon.ico {
		access_log off;
		log_not_found off;
	}
	location /robots.txt {
		access_log off;
		log_not_found off;
	}
	location ~ /\. {
		deny all;
	}
	location ~ \.svg$ {
		add_header Content-Security-Policy "default-src 'none'; frame-ancestors 'none'; style-src 'self' 'unsafe-inline'";
	}
	location / {
		expires $www_textpattern_com_expires;
		index index.html index.php;
		limit_except GET HEAD POST {
			deny all;
		}
		rewrite "^(.*?)\.[0-9]+\.(css|js|svg)$" "$1.$2";
		rewrite ^/plugins/txp_plugin_template.txt$ https://github.com/textpattern/textpattern-plugin-template permanent;
		rewrite ^/forum$$ https://forum.textpattern.io permanent;
		rewrite ^/@textpattern$ https://twitter.com/textpattern redirect;
		rewrite ^/\+$ https://plus.google.com/+textpattern redirect;
		rewrite ^/github$ https://github.com/textpattern redirect;
		rewrite ^/demo$ https://textpattern.co/demo redirect;
		rewrite ^/textpattern-first-steps$ https://docs.textpattern.com/faqs/textpattern-basic-tutorial redirect;
		rewrite ^/textpattern-semantic-model$ https://docs.textpattern.com/faqs/textpattern-semantic-model redirect;
		rewrite ^/textpattern-tag-reference$ https://docs.textpattern.com/tags redirect;
		rewrite ^/hidden-files-osx$ https://docs.textpattern.com/installation/view-hidden-files-on-macos redirect;
		rewrite ^/default-theme$ https://github.com/textpattern/textpattern-default-theme redirect;
		rewrite ^/languages$ https://textpattern.com/about/301/languages redirect;
		rewrite ^/textpacks-download$ https://github.com/textpattern/textpacks/releases/download/4.7.1/textpacks.zip redirect;
		rewrite ^/pophelp-download$ https://github.com/textpattern/pophelp/releases/download/4.7.1/help.zip redirect;
		rewrite ^/textile-changelog$ https://github.com/textile/php-textile/blob/master/CHANGELOG.textile redirect;
		rewrite ^/textile-sandbox$ https://txstyle.org/article/43/a-short-introduction redirect;
		rewrite ^/textile-reference-manual$ https://txstyle.org redirect;
		rewrite ^/textile-abbr$ https://txstyle.org/doc/32/acronyms redirect;
		rewrite ^/textile-blockquote$ https://txstyle.org/doc/3/block-quotations redirect;
		rewrite ^/textile-cite$ https://txstyle.org/doc/20/citation redirect;
		rewrite ^/textile-dl-list$ https://txstyle.org/doc/10/definition-lists redirect;
		rewrite ^/textile-em-and-i$ https://txstyle.org/doc/17/emphasized-and-italic-text redirect;
		rewrite ^/textile-footnote$ https://txstyle.org/doc/11/footnotes redirect;
		rewrite ^/textile-heading$ https://txstyle.org/doc/7/headings redirect;
		rewrite ^/textile-image$ https://txstyle.org/doc/14/images redirect;
		rewrite ^/textile-ins-and-del$ https://txstyle.org/doc/19/insertions-and-deletions redirect;
		rewrite ^/textile-link$ https://txstyle.org/doc/12/links redirect;
		rewrite ^/textile-ol-list$ https://txstyle.org/doc/9/numbered-lists redirect;
		rewrite ^/textile-span$ https://txstyle.org/doc/33/span redirect;
		rewrite ^/textile-strong-and-b$ https://txstyle.org/doc/16/strong-and-bold-text redirect;
		rewrite ^/textile-sub-and-sup$ https://txstyle.org/doc/18/subscript-and-superscript-text redirect;
		rewrite ^/textile-table$ https://txstyle.org/doc/15/tables redirect;
		rewrite ^/textile-ul-list$ https://txstyle.org/doc/8/bullet-list redirect;
		rewrite ^/donate$ https://textpattern.com/about/302/patrons permanent;
		rewrite ^/download$ https://textpattern.com/start permanent;
		rewrite ^/download-beta$ https://textpattern.com/start permanent;
		rewrite ^/featured$ https://textpattern.com/showcase permanent;
		rewrite ^/documentation$ https://docs.textpattern.com permanent;
		rewrite ^/features$ https://textpattern.com/about/338/textpattern-features permanent;
		rewrite ^/system-requirements$ https://textpattern.com/about/119/system-requirements permanent;
		rewrite ^/support$ https://textpattern.com/about/345/community-support permanent;
		rewrite ^/features/301/languages$ https://textpattern.com/about/301/languages permanent;
		rewrite ^/contributors$ https://textpattern.com/about/219/contributors permanent;
		rewrite ^/patrons$ https://textpattern.com/about/302/patrons permanent;
		rewrite ^/hosting$ https://textpattern.com/about/363/web-hosting permanent;
		rewrite ^/security$ https://textpattern.com/contact#security permanent;
		rewrite ^/releases$ https://textpattern.com/category/releases permanent;
		rewrite ^/faq.*$ https://docs.textpattern.com permanent;
		rewrite ^/themes$ https://docs.textpattern.com/themes/ redirect;
		rewrite ^/plugins$ https://textpattern.org/ redirect;
		try_files $uri $uri/ /index.php?$args;
	}
	location ~ ^.+\.php(?:/.*)?$ {
		fastcgi_hide_header "X-Powered-By";
		fastcgi_index index.php;
		fastcgi_keep_conn on;
		fastcgi_next_upstream error timeout;
		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
		fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;
		fastcgi_split_path_info ^(.+\.php)(/.+)$;
		include fastcgi_params;
		try_files $uri =404;
	}
}
#end www.textpattern.com server block
