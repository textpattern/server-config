#server block for www.textpattern.com (hash: 1b8835e8)
map $sent_http_content_type $expires_1b8835e8 {
    application/atom+xml 1h;
    application/javascript 1M;
    application/json 0s;
    application/ld+json 0s;
    application/manifest+json 1w;
    application/rdf+xml 1h;
    application/rss+xml 1h;
    application/schema+json 0s;
    application/x-javascript 1M;
    application/xml 0s;
    font/woff 1y;
    font/woff2 1y;
    image/gif 1y;
    image/jpeg 1y;
    image/png 1y;
    image/svg+xml 1y;
    image/vnd.microsoft.icon 1M;
    image/webp 1y;
    image/x-icon 1M;
    text/cache-manifest 0s;
    text/css 1M;
    text/html 0s;
    text/javascript 1M;
    text/x-cross-domain-policy 1w;
    text/xml 3600s;
    video/mp4 1y;
    video/webm 1y;
    default 0s;
}

server {#http(/1), https(/2) return, PHP FastCGI
    access_log /var/log/nginx/www.textpattern.com.access.log ipscrubbed;
    error_log /var/log/nginx/www.textpattern.com.error.log error;
    index index.html index.php;
    listen [::]:80;
    listen 80;
    return 301 https://textpattern.com$request_uri;
    root /var/www/vhosts/textpattern.com/www/live;
    server_name www.textpattern.com;
    server_name textpattern.com;
    location ^~ /.well-known/ {
        allow all;
        default_type "text/plain";
        root /var/www/vhosts/textpattern.com/www/_well-known/;
        try_files $uri $uri/ =404;
    }
    location /favicon.ico {
        access_log off;
        log_not_found off;
    }
    location /robots.txt {
        access_log off;
        log_not_found off;
    }
    location ~ /\. {
        deny all;
    }
    location / {
        index index.html index.php;
        limit_except GET HEAD POST {
            deny all;
        }
        try_files $uri $uri/ /index.php$is_args$args;
    }
    location ~ ^.+\.php(?:/.*)?$ {
        fastcgi_hide_header "X-Powered-By";
        fastcgi_index index.php;
        fastcgi_keep_conn on;
        fastcgi_next_upstream error timeout;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        include fastcgi_params;
        try_files $uri =404;
    }
}

server {#https(/2), redirect https://www.textpattern.com to https://textpattern.com
    listen [::]:443 http2 ssl;
    listen 443 http2 ssl;
    server_name www.textpattern.com;
    ssl_certificate /etc/letsencrypt/live/www.textpattern.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/www.textpattern.com/privkey.pem;
    ssl_trusted_certificate /etc/letsencrypt/live/www.textpattern.com/fullchain.pem;
    return 301 https://textpattern.com$request_uri;
}

server {#https(/2), PHP FastCGI
    access_log /var/log/nginx/www.textpattern.com.access.log ipscrubbed;
    #nested variable for Content Security Policy maintainability
    set $csp_1b8835e8 '';
    set $csp_1b8835e8 '${csp_1b8835e8}base-uri \'self\';';
    set $csp_1b8835e8 '${csp_1b8835e8}block-all-mixed-content;';
    set $csp_1b8835e8 '${csp_1b8835e8}connect-src https://website.informer.com \'self\';';
    set $csp_1b8835e8 '${csp_1b8835e8}default-src \'none\';';
    set $csp_1b8835e8 '${csp_1b8835e8}font-src \'self\';';
    set $csp_1b8835e8 '${csp_1b8835e8}form-action \'self\';';
    set $csp_1b8835e8 '${csp_1b8835e8}frame-ancestors \'none\';';
    set $csp_1b8835e8 '${csp_1b8835e8}img-src data: \'self\';';
    set $csp_1b8835e8 '${csp_1b8835e8}manifest-src \'self\';';
    set $csp_1b8835e8 '${csp_1b8835e8}media-src \'self\';';
    set $csp_1b8835e8 '${csp_1b8835e8}script-src \'self\' \'unsafe-inline\';';
    set $csp_1b8835e8 '${csp_1b8835e8}style-src \'self\' \'unsafe-inline\';';
    set $csp_1b8835e8 '${csp_1b8835e8}style-src-elem \'self\';';
    set $csp_1b8835e8 '${csp_1b8835e8}style-src-attr \'unsafe-inline\';';
    set $csp_1b8835e8 '${csp_1b8835e8}worker-src \'none\';';
    add_header Content-Security-Policy $csp_1b8835e8;
    set $fp_1b8835e8 '';
    set $fp_1b8835e8 '${fp_1b8835e8}accelerometer \'none\';';
    set $fp_1b8835e8 '${fp_1b8835e8}ambient-light-sensor \'none\';';
    set $fp_1b8835e8 '${fp_1b8835e8}autoplay \'none\';';
    set $fp_1b8835e8 '${fp_1b8835e8}battery \'none\';';
    set $fp_1b8835e8 '${fp_1b8835e8}camera \'none\';';
    set $fp_1b8835e8 '${fp_1b8835e8}fullscreen \'self\';';
    set $fp_1b8835e8 '${fp_1b8835e8}geolocation \'none\';';
    set $fp_1b8835e8 '${fp_1b8835e8}gyroscope \'none\';';
    set $fp_1b8835e8 '${fp_1b8835e8}magnetometer \'none\';';
    set $fp_1b8835e8 '${fp_1b8835e8}microphone \'none\';';
    set $fp_1b8835e8 '${fp_1b8835e8}midi \'none\';';
    set $fp_1b8835e8 '${fp_1b8835e8}payment \'none\';';
    set $fp_1b8835e8 '${fp_1b8835e8}picture-in-picture \'none\';';
    set $fp_1b8835e8 '${fp_1b8835e8}sync-xhr \'self\';';
    set $fp_1b8835e8 '${fp_1b8835e8}usb \'none\''; #no trailing semicolon
    add_header Access-Control-Allow-Origin *;
    add_header Expect-CT "enforce; max-age=30; report-uri=https://textpattern.com/expect-ct-report";
    add_header Feature-Policy $fp_1b8835e8;
    add_header Referrer-Policy strict-origin;
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload";
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options DENY;
    add_header X-XSS-Protection "1; mode=block";
    charset_types
        application/atom+xml
        application/javascript
        application/json
        application/ld+json
        application/manifest+json
        application/rdf+xml
        application/rss+xml
        application/xml
        text/cache-manifest
        text/css
    ;
    error_log /var/log/nginx/www.textpattern.com.error.log error;
    etag off;
    index index.html index.php;
    listen [::]:443 http2 ssl;
    listen 443 http2 ssl;
    root /var/www/vhosts/textpattern.com/www/live;
    server_name textpattern.com;
    ssl_certificate /etc/letsencrypt/live/www.textpattern.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/www.textpattern.com/privkey.pem;
    ssl_trusted_certificate /etc/letsencrypt/live/www.textpattern.com/fullchain.pem;
    location = /latest.tar.gz {
        rewrite "latest.tar.gz" https://textpattern.com/file_download/100/textpattern-4.8.1.tar.gz;
    }
    location = /latest.zip {
        rewrite "latest.zip" https://textpattern.com/file_download/101/textpattern-4.8.1.zip;
    }
    location = /sitemap.xml {
        rewrite "sitemap.xml" /index.php?s=sitemap;
    }
    location = /version.json {
        rewrite "version.json" /index.php?s=version;
    }
    location ^~ /.well-known/ {
        allow all;
        default_type "text/plain";
        root /var/www/vhosts/textpattern.com/www/_well-known/;
        try_files $uri $uri/ =404;
    }
    location /favicon.ico {
        access_log off;
        log_not_found off;
    }
    location /robots.txt {
        access_log off;
        log_not_found off;
    }
    location ~ /\. {
        deny all;
    }
    location / {
        expires $expires_1b8835e8;
        index index.html index.php;
        limit_except GET HEAD POST {
            deny all;
        }
        rewrite "^(.*?)\.[0-9]+\.(css|js|svg)$" "$1.$2";
        rewrite ^/@textpattern$ https://twitter.com/textpattern redirect;
        rewrite ^/contributors$ https://textpattern.com/about/219/contributors permanent;
        rewrite ^/default-theme$ https://github.com/textpattern/textpattern-default-theme redirect;
        rewrite ^/demo$ https://textpattern.co/demo redirect;
        rewrite ^/documentation$ https://docs.textpattern.com permanent;
        rewrite ^/donate$ https://textpattern.com/about/302/patrons permanent;
        rewrite ^/download-beta$ https://textpattern.com/start permanent;
        rewrite ^/download$ https://textpattern.com/start permanent;
        rewrite ^/faq.*$ https://docs.textpattern.com permanent;
        rewrite ^/featured$ https://textpattern.com/showcase permanent;
        rewrite ^/features/301/languages$ https://textpattern.com/about/301/languages permanent;
        rewrite ^/features$ https://textpattern.com/about/338/textpattern-features permanent;
        rewrite ^/forum$$ https://forum.textpattern.io permanent;
        rewrite ^/github$ https://github.com/textpattern redirect;
        rewrite ^/hidden-files-osx$ https://docs.textpattern.com/installation/view-hidden-files-on-macos redirect;
        rewrite ^/hosting$ https://textpattern.com/about/363/web-hosting permanent;
        rewrite ^/languages$ https://textpattern.com/about/301/languages redirect;
        rewrite ^/patrons$ https://textpattern.com/about/302/patrons permanent;
        rewrite ^/plugins/txp_plugin_template.txt$ https://github.com/textpattern/textpattern-plugin-template permanent;
        rewrite ^/plugins$ https://textpattern.org/ redirect;
        rewrite ^/pophelp-download$ https://github.com/textpattern/pophelp/releases/download/4.8.1/help.zip redirect;
        rewrite ^/releases$ https://textpattern.com/category/releases permanent;
        rewrite ^/security$ https://textpattern.com/contact#security permanent;
        rewrite ^/support$ https://textpattern.com/about/345/community-support permanent;
        rewrite ^/system-requirements$ https://textpattern.com/about/119/system-requirements permanent;
        rewrite ^/textile-abbr$ https://textile-lang.com/doc/acronyms-abbreviations redirect;
        rewrite ^/textile-blockquote$ https://textile-lang.com/doc/block-quotations redirect;
        rewrite ^/textile-changelog$ https://github.com/textile/php-textile/blob/master/CHANGELOG.textile redirect;
        rewrite ^/textile-cite$ https://textile-lang.com/doc/citations redirect;
        rewrite ^/textile-dl-list$ https://textile-lang.com/doc/definition-lists redirect;
        rewrite ^/textile-em-and-i$ https://textile-lang.com/doc/emphasized-and-italic-text redirect;
        rewrite ^/textile-footnote$ https://textile-lang.com/doc/footnotes redirect;
        rewrite ^/textile-heading$ https://textile-lang.com/doc/headings redirect;
        rewrite ^/textile-image$ https://textile-lang.com/doc/images redirect;
        rewrite ^/textile-ins-and-del$ https://textile-lang.com/doc/insertions-and-deletions redirect;
        rewrite ^/textile-link$ https://textile-lang.com/doc/links redirect;
        rewrite ^/textile-ol-list$ https://textile-lang.com/doc/numbered-ordered-lists redirect;
        rewrite ^/textile-reference-manual$ https://textile-lang.com redirect;
        rewrite ^/textile-sandbox$ https://textile-lang.com/#headline redirect;
        rewrite ^/textile-span$ https://textile-lang.com/doc/spans redirect;
        rewrite ^/textile-strong-and-b$ https://textile-lang.com/doc/strong-and-bold-text redirect;
        rewrite ^/textile-sub-and-sup$ https://textile-lang.com/doc/subscript-and-superscript-text redirect;
        rewrite ^/textile-table$ https://textile-lang.com/doc/tables redirect;
        rewrite ^/textile-ul-list$ https://textile-lang.com/doc/bulleted-unordered-lists redirect;
        rewrite ^/textpacks-download$ https://github.com/textpattern/textpacks/releases/download/4.8.1/lang.zip redirect;
        rewrite ^/textpattern-first-steps$ https://docs.textpattern.com/faqs/textpattern-basic-tutorial redirect;
        rewrite ^/textpattern-multi-site-installation$ https://docs.textpattern.com/setup/multi-site-installation redirect;
        rewrite ^/textpattern-semantic-model$ https://docs.textpattern.com/faqs/textpattern-semantic-model redirect;
        rewrite ^/textpattern-tag-reference$ https://docs.textpattern.com/tags redirect;
        rewrite ^/themes$ https://docs.textpattern.com/build/themes-creating-using-and-sharing redirect;
        try_files $uri $uri/ /index.php$is_args$args;
    }
    location ~ ^.+\.php(?:/.*)?$ {
        fastcgi_hide_header "X-Powered-By";
        fastcgi_index index.php;
        fastcgi_keep_conn on;
        fastcgi_next_upstream error timeout;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        include fastcgi_params;
        try_files $uri =404;
    }
}
#end www.textpattern.com server block
