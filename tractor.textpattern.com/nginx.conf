# start `nginx.conf` at `/etc/nginx/nginx.conf` (v20180820)
load_module /usr/lib/nginx/modules/ngx_http_headers_more_filter_module.so;
load_module /usr/lib/nginx/modules/ngx_http_image_filter_module.so;
load_module /usr/lib/nginx/modules/ngx_http_length_hiding_filter_module.so;
load_module /usr/lib/nginx/modules/ngx_http_naxsi_module.so;
load_module /usr/lib/nginx/modules/ngx_http_vhost_traffic_status_module.so;
load_module /usr/lib/nginx/modules/ngx_http_xslt_filter_module.so;
load_module /usr/lib/nginx/modules/ngx_ipscrub_module.so;
load_module /usr/lib/nginx/modules/ngx_pagespeed.so;
load_module /usr/lib/nginx/modules/ngx_stream_module.so;
pid /var/run/nginx.pid;
user www-data www-data;
worker_processes auto;
worker_rlimit_nofile 3072;

events {
	worker_connections 2048;
}

http {#check https://cipherli.st for latest ciphers etc
	#dependencies
	log_format ipscrubbed '$remote_addr_ipscrub - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for" "$gzip_ratio"';
	#standard stuff
	access_log /var/log/nginx/access.log ipscrubbed;
	charset UTF-8;
	client_max_body_size 128M;
	default_type application/octet-stream;
	error_log /var/log/nginx/error.log crit;
	fastcgi_cache_path /var/cache/nginx/ levels=1:1 keys_zone=phpCache:16m max_size=256m inactive=1d;
	gzip on;
	gzip_buffers 16 8k;
	gzip_comp_level 6;
	gzip_disable "msie6";
	gzip_http_version 1.0;
	gzip_min_length 256;
	gzip_proxied any;
	gzip_types application/atom+xml application/javascript application/json application/ld+json application/manifest+json application/rss+xml application/vnd.geo+json application/vnd.ms-fontobject application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/svg+xml image/x-icon text/cache-manifest text/css text/plain text/vcard text/vnd.rim.location.xloc text/vtt text/x-component text/x-cross-domain-policy;
	gzip_vary on;
	include /etc/nginx/mime.types;
	keepalive_timeout 60s;
	length_hiding on;
	length_hiding_max 1024;
	limit_conn_zone $binary_remote_addr zone=conPerIp:5m;
	limit_req_zone $binary_remote_addr zone=reqPerSec1:1m rate=1r/s;
	limit_req_zone $binary_remote_addr zone=reqPerSec10:1m rate=10r/s;
	limit_req_zone $binary_remote_addr zone=reqPerSec20:1m rate=20r/s;
	log_not_found off;
	map_hash_bucket_size 128;
	map $arg_title $docs_target {
		Administration_workflow administration;
		Advanced_Preferences administration/preferences-panel;
		alphabetical_tag_listing tags;
		article tags/article;
		article_custom tags/article_custom;
		article_id tags/article_id;
		article_image tags/article_image;
		article_url_title tags/article_url_title;
		Articles administration/articles-panel;
		author tags/author;
		author_email tags/author_email;
		Basic_Preferences administration/preferences-panel;
		body tags/body;
		breadcrumb tags/breadcrumb;
		categories administration/categories-panel;
		category tags/category;
		category_list tags/category_list;
		Category:Article_Tags tags/article-tags;
		Category:Comment_Tags tags/comment-tags;
		Category:Conditional_Tags tags/conditional-tags;
		Category:Error_Handling_Tags tags/error-handling-tags;
		Category:File_Tags tags/file-tags;
		Category:Future_Tags tags/future-tags;
		Category:Image_Tags tags/image-tags;
		Category:Link_Tags tags/link-tags;
		Category:List_Tags tags/list-tags;
		Category:Markup_Tags tags/markup-tags;
		Category:Navigation_Tags tags/navigation-tags;
		Category:Programmer_Tags tags/programmer-tags;
		Category:Search_Tags tags/search-tags;
		Category:Structural_Tags tags/structural-tags;
		Category:Tag_Reference tags;
		Category:Troubleshooting installation/troubleshooting-textpattern;
		category1 tags/category1;
		category2 tags/category2;
		comment_anchor tags/comment_anchor;
		comment_email tags/comment_email;
		comment_email_input tags/comment_email_input;
		comment_id tags/comment_id;
		comment_message tags/comment_message;
		comment_message_input tags/comment_message_input;
		comment_name tags/comment_name;
		comment_name_input tags/comment_name_input;
		comment_permlink tags/comment_permlink;
		comment_preview tags/comment_preview;
		comment_remember tags/comment_remember;
		comment_submit tags/comment_submit;
		comment_time tags/comment_time;
		comment_web tags/comment_web;
		comment_web_input tags/comment_web_input;
		comments tags/comments;
		Comments_(admin-side) administration/comments-panel;
		comments_count tags/comments_count;
		comments_error tags/comments_error;
		comments_form tags/comments_form;
		comments_help tags/comments_help;
		comments_invite tags/comments_invite;
		comments_preview tags/comments_preview;
		Core_callback_list development/core-callbacks-reference;
		Creating_Textpattern_themes themes;
		css tags/css;
		custom_field tags/custom_field;
		Database_Schema_Reference development/database-schema-reference;
		detailed_installation_instructions installation;
		diagnostics administration/diagnostics-panel;
		Diagnostics_Subtab administration/diagnostics-panel;
		else tags/else;
		email tags/email;
		en/Main_Page "";
		error_message tags/error_message;
		error_status tags/error_status;
		excerpt tags/excerpt;
		expires tags/expires;
		feed_link tags/feed_link;
		file_download tags/file_download;
		file_download_author tags/file_download_author;
		file_download_category tags/file_download_category;
		file_download_created tags/file_download_created;
		file_download_description tags/file_download_description;
		file_download_downloads tags/file_download_downloads;
		file_download_id tags/file_download_id;
		file_download_link tags/file_download_link;
		file_download_list tags/file_download_list;
		file_download_modified tags/file_download_modified;
		file_download_name tags/file_download_name;
		file_download_size tags/file_download_size;
		Files administration/files-panel;
		Forms administration/forms-panel;
		Getting_Started_with_Textpattern installation/installing-textpattern;
		glossary "";
		hide tags/hide;
		if_article_author tags/if_article_author;
		if_article_category tags/if_article_category;
		if_article_id tags/if_article_id;
		if_article_image tags/if_article_image;
		if_article_list tags/if_article_list;
		if_article_section tags/if_article_section;
		if_author tags/if_author;
		if_category tags/if_category;
		if_comments tags/if_comments;
		if_comments_allowed tags/if_comments_allowed;
		if_comments_disallowed tags/if_comments_disallowed;
		if_comments_error tags/if_comments_error;
		if_comments_preview tags/if_comments_preview;
		if_custom_field tags/if_custom_field;
		if_different tags/if_different;
		if_excerpt tags/if_excerpt;
		if_expired tags/if_expired;
		if_expires tags/if_expires;
		if_first_article tags/if_first_article;
		if_first_category tags/if_first_category;
		if_first_section tags/if_first_section;
		if_individual_article tags/if_individual_article;
		if_keywords tags/if_keywords;
		if_last_article tags/if_last_article;
		if_last_category tags/if_last_category;
		if_last_section tags/if_last_section;
		if_plugin tags/if_plugin;
		if_search tags/if_search;
		if_search_results tags/if_search_results;
		if_section tags/if_section;
		if_status tags/if_status;
		if_thumbnail tags/if_thumbnail;
		if_variable tags/if_variable;
		image tags/image;
		image_author tags/image_author;
		image_date tags/image_date;
		image_display tags/image_display;
		image_index tags/image_index;
		image_info tags/image_info;
		image_url tags/image_url;
		images tags/images;
		Images_(panel) administration/images-panel;
		Import administration;
		Index "";
		Installation installation;
		keywords tags/keywords;
		lang tags/lang;
		Language_Preferences administration/languages-panel;
		link tags/link;
		link_author tags/link_author;
		link_category tags/link_category;
		link_date tags/link_date;
		link_description tags/link_description;
		link_feed_link tags/link_feed_link;
		link_id tags/link_id;
		link_name tags/link_name;
		link_to_home tags/link_to_home;
		link_to_next tags/link_to_next;
		link_to_prev tags/link_to_prev;
		link_url tags/link_url;
		linkdesctitle tags/linkdesctitle;
		linklist tags/linklist;
		Links administration/links-panel;
		Making_the_Textpattern_Installation_More_Secure administration/security;
		meta_author tags/meta_author;
		meta_keywords tags/meta_keywords;
		modified tags/modified;
		Moving_Installation_from_one_Host_to_Another installation/moving-textpattern;
		newer tags/newer;
		next_title tags/next_title;
		older tags/older;
		output_form tags/output_form;
		page_title tags/page_title;
		page_url tags/page_url;
		Pages administration/pages-panel;
		Parsing_Tag_Attributes tags/tag-basics/parsing-tag-attributes;
		password_protect tags/password_protect;
		permlink tags/permlink;
		php tags/php;
		plugins administration/plugins-panel;
		popup tags/popup;
		posted tags/posted;
		Preferences_Subtab administration/preferences-panel;
		prev_title tags/prev_title;
		recent_articles tags/recent_articles;
		recent_comments tags/recent_comments;
		Recovering_from_a_security_breach administration/security;
		related_articles tags/related_articles;
		rsd tags/rsd;
		search_input tags/search_input;
		search_result_count tags/search_result_count;
		search_result_date tags/search_result_date;
		search_result_excerpt tags/search_result_excerpt;
		search_result_title tags/search_result_title;
		search_result_url tags/search_result_url;
		search_term tags/search_term;
		section tags/section;
		section_list tags/section_list;
		sections administration/sections-panel;
		Securing_your_site_from_attack administration/security;
		self-closed_versus_container_tags tags/tag-basics/self-closed-versus-container-tags;
		Single_Tag tags/tag-basics/self-closed-versus-container-tags;
		site_name tags/site_name;
		site_slogan tags/site_slogan;
		site_url tags/site_url;
		Styles administration/styles-panel;
		Tag_Basics tags/tag-basics;
		tag_trace installation/troubleshooting-textpattern#the-tag-trace;
		text tags/text;
		Textpattern_CMS_User_Documentation:About "";
		Textpattern_FAQs faqs;
		Textpattern_Quickstart:_Hello_World administration/hello-world;
		thumbnail tags/thumbnail;
		title tags/title;
		txp_die tags/txp_die;
		User_Roles_and_Permissions administration/user-roles-and-privileges;
		Users administration/users-panel;
		variable tags/variable;
		Visitor_Logs administration/visitor-logs-panel;
		wiki/index.php?title=Admin-side administration;
		Write administration/write-panel;
		yield tags/yield;
	}
	max_ranges 0;
	msie_padding off;
	resolver 1.1.1.1 9.9.9.9 [2606:4700:4700::1111] [2620:fe::fe] valid=10s;
	resolver_timeout 5s;
	sendfile on;
	server_tokens off;
	ssl_buffer_size 8k;
	ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256;
	ssl_dhparam /etc/nginx/ssl/dhparam4096.pem;
	ssl_ecdh_curve secp384r1;
	ssl_prefer_server_ciphers on;
	ssl_protocols TLSv1.3 TLSv1.2;
	ssl_session_cache shared:SSL:10m;
	ssl_session_tickets off;
	ssl_session_timeout 10m;
	ssl_stapling on;
	ssl_stapling_verify on;
	tcp_nodelay on;
	tcp_nopush on;
	types_hash_max_size 2048;
	#last but not least
	include /etc/nginx/sites-enabled/*;
}
#end `nginx.conf`

